# フォトブック管理アプリケーション

画像をサムネイル表示し、選択・ラベル付け・順序付けを行い、一括リネームができるPySide6ベースのGUIアプリケーションです。

## 主な機能

### 基本機能
- **画像フォルダ読み込み**: フォルダ内の画像をサムネイル表示
- **並び替え**: 撮影日時（EXIF）またはファイル名でソート
- **選択バスケット**: 選択した画像を順序付けて管理
- **ラベル付け**: 画像にラベルを付与（全景、接写、内部など）
- **プレビュー**: リネーム後のファイル名を事前確認
- **一括リネーム**: テンプレートに基づいて一括リネーム
- **Undo機能**: 直前のリネームを元に戻す

### 新機能（2025-11-05追加）
- **バスケット内複数選択**: Ctrl+クリックやShift+クリックでバスケット内の複数アイテムを選択可能
- **選択的ラベル適用**: バスケット内で選択したアイテムのみにラベルを適用
- **JSON出力**: 画像とラベルの関係をJSON形式でエクスポート

## 利用可能なバージョン

このアプリケーションは2つのバージョンで提供されています：

### 🖥️ デスクトップ版（このREADME）
- PySide6ベースのネイティブGUIアプリケーション
- 起動: `python main.py`

### 🌐 Web版（NEW!）
- ブラウザで動作するWebアプリケーション
- デスクトップ版と**完全に同じ機能**
- 起動: `start_web.bat` (Windows) / `start_web.sh` (Mac/Linux)
- 詳細は [web/README.md](web/README.md) を参照

---

## 動作環境（デスクトップ版）

- Python 3.10以上
- PySide6
- Pillow（画像処理）
- pillow-heif（HEIC対応、オプション）

## インストール（デスクトップ版）

```bash
# 基本的な依存関係をインストール
pip install -r requirements.txt

# HEIC形式の画像を扱う場合（オプション）
pip install -r requirements-heic.txt
```

## 使い方

### アプリケーションの起動

```bash
python main.py
```

### 基本的な操作フロー

1. **フォルダを開く**: 左上の「フォルダを開く」ボタンから画像フォルダを選択
2. **画像を選択**: サムネイルをクリックして選択バスケットに追加
3. **ラベル付け**:
   - キーボードの数字キー（1-9）でラベルを適用
   - または右ペインのラベルプリセットから選択
4. **順序調整**: バスケット内でドラッグ&ドロップで並べ替え
5. **プレビュー**: 「プレビュー」ボタンでリネーム結果を確認
6. **実行**: 「実行」ボタンでリネームを実行
7. **JSON出力**: 「JSON出力」ボタンで画像情報をエクスポート

### バスケット内の複数選択機能

- **単一選択**: バスケット内のアイテムをクリック
- **複数選択（個別）**: Ctrl+クリックで追加選択
- **範囲選択**: Shift+クリックで範囲選択
- **ラベル適用**:
  - バスケット内でアイテムを選択してから数字キー（1-9）を押すと、選択したアイテムのみにラベルが適用されます
  - 何も選択していない場合は、サムネイルグリッドで選択した画像に適用されます

### キーボードショートカット

- **1-9キー**: 対応するラベルを適用（バスケット内の選択を優先）
- **Delete**: サムネイルグリッドの選択をクリア

### ラベルプリセット

デフォルトのラベル：
1. 全景
2. 接写
3. 内部
4. 測定
5. 詳細
6. 外観

「設定...」ボタンからカスタマイズ可能です。

### リネームテンプレート

デフォルト: `V-{group}_{label}_{seq:003}`

使用可能な変数：
- `{group}`: グループ番号
- `{label}`: ラベル名
- `{seq:003}`: 連番（ゼロ埋め3桁）

例: `V-1_全景_001.jpg`

### JSON出力形式

エクスポートされるJSONファイルの形式：

```json
{
  "export_date": "2025-11-05 10:30:00",
  "total_count": 10,
  "items": [
    {
      "order": 1,
      "file_name": "IMG_001.jpg",
      "file_path": "/path/to/IMG_001.jpg",
      "label": "全景",
      "group": 1
    }
  ]
}
```

## プロジェクト構造

```
Photo-Album-Management-App/
├── main.py                    # デスクトップ版メインアプリケーション
├── requirements.txt           # Python依存関係
├── requirements-heic.txt      # HEIC対応（オプション）
├── README.md                  # このファイル
├── start_web.bat              # Web版起動スクリプト（Windows）
├── start_web.sh               # Web版起動スクリプト（Mac/Linux）
├── widgets/                   # UIウィジェット（デスクトップ版）
│   ├── thumbnail_grid.py      # サムネイルグリッド
│   ├── selection_bucket.py    # 選択バスケット
│   └── label_preset_dialog.py # ラベル設定ダイアログ
├── services/                  # ビジネスロジック（共通）
│   ├── thumbnail_cache.py     # サムネイルキャッシュ
│   ├── exif.py                # EXIF情報読み取り
│   └── renamer.py             # リネーム処理
├── utils/                     # ユーティリティ（共通）
│   └── pathsafe.py            # パス操作ヘルパー
└── web/                       # Web版（NEW!）
    ├── server.py              # Flaskサーバー
    ├── requirements-web.txt   # Web版の依存関係
    ├── README.md              # Web版のREADME
    └── static/
        ├── index.html         # メインHTML
        ├── css/
        │   └── style.css      # スタイルシート
        └── js/
            └── app.js         # JavaScriptアプリケーション
```

## トラブルシューティング

### 画像が表示されない
- 対応フォーマット: JPG, PNG, HEIC, GIF, BMP
- HEIC形式の場合は`requirements-heic.txt`をインストール

### リネームが失敗する
- ファイルが他のアプリケーションで開かれていないか確認
- 書き込み権限があるか確認

### Undoできない
- Undoは直前の1回のリネーム操作のみ対象
- アプリケーション再起動後は履歴がクリアされます

## ライセンス

このプロジェクトは内部利用を想定しています。

---

**作成日**: 2025-11-05
**バージョン**: 2.0
